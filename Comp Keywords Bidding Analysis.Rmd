---
title: "Competitors Keywords Bidding Analysis"
author: "Jiying Lu"
date: "3/30/2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#
#Environment set up
```{r}
library(data.table)
library(MASS)
library(foreign)
library(gplots)
library(lmtest)
library(usdm)
library(sandwich)
library(plyr)
library(tidyverse)
install.packages("reshape2")
library(reshape2)
library(calibrate)
library(car)
library(cluster)
install.packages("rcompanion")
library(rcompanion)

rm(list=ls())  
setwd("/Users/lucute/Desktop/SCU/MKT Analytics/Project")
fdf <- read.csv(file.choose())
```

## Business Questions:
1. In general, does bidding on competitive keywords help our sales or damage competitors' sales?
2. In which regions/segments, does bidding on competitive keywords have the greatest negative impact on the competitionâ€™s sales?
3. For the regions/segments that bidding has a negative impact, which segments/regions should we focus?
4. For a particular region/segments, against which competitor do we have the greatest opportunity to impact sales negatively? 


## Take a look of data:
```{r}
dim(fdf) # 126720 observations, 36 variables
head(fdf)
summary(fdf)
count(fdf$segment) #1,2,3,5,7,8,9,10,11,12,13,14,15,16 lowest:1920
count(fdf$region) #1-32
count(fdf$brand) #1-14 lowest:1920
```

## Analysis Strategy:
1.Based on the following reasons: first, both our and competitors' sales varies from different segments, regions, and time periods, second, the spend on this month may have greater effect on next month or next two month's sales, I use the gap between our and competitors' next month (next two month) sales as dependent variable.
2.For the segment perspective, I separate the data into 14 different segments and try to find the "most fitted" model for each segment. From these different models, I can observe the impact of keyword bidding on the gap of sales. I assume the error terms for these models may correlate across each others so that seemingly unrelated regressions can be applied for this analysis. However, I don't have equal observations among the segments, I'll use linear regression models for each segments instead.
3.I do have equal amount of observations for each region, so I'll do the same approaches as segment part but using full data set instead.

#Plots of data
```{r}
sub <- as.data.table(cbind(my = fdf$month_year,total = fdf$total_segment_sales, ford = fdf$ford_sales, comp = fdf$comp_sales, segment = fdf$segment, year = fdf$year))

sub2 <- as.data.table(cbind(my = fdf$month_year,total = fdf$total_segment_sales, ford = fdf$ford_sales, comp = fdf$comp_sales))
suba <- as.data.table(aggregate(sub2, by = list(factor(sub2$my)), FUN = sum))
subm <- melt.data.table(suba,measure.vars = c("ford","total","comp"))
ggplot(data = subm, aes(x = Group.1, y = value, group = variable)) + 
  geom_line(aes(color = variable))

#year by year
#2016
y2016 <- fdf[fdf["year"] == 2016,]

sub2016 <- as.data.table(cbind(my = y2016$month_year, ford = y2016$ford_sales, comp = y2016$comp_sales))
y2016a <- as.data.table(aggregate(sub2016, by = list(factor(sub2016$my)), FUN = sum))
y2016a$my <- NULL
subm2016 <- melt.data.table(y2016a,measure.vars = c("ford","comp"))

ggplot(data = subm2016, aes(x = Group.1, y = value, group = variable)) + 
  geom_line(aes(color = variable))

#2015
y2015 <- fdf[fdf["year"] == 2015,]

sub2015 <- as.data.table(cbind(my = y2015$month_year, ford = y2015$ford_sales, comp = y2015$comp_sales))
y2015a <- as.data.table(aggregate(sub2015, by = list(factor(sub2015$my)), FUN = sum))
y2015a$my <- NULL
subm2015 <- melt.data.table(y2015a,measure.vars = c("ford","comp"))

ggplot(data = subm2015, aes(x = Group.1, y = value, group = variable)) + 
  geom_line(aes(color = variable))


#2014
y2014 <- fdf[fdf["year"] == 2014,]

sub2014 <- as.data.table(cbind(my = y2014$month_year, ford = y2014$ford_sales, comp = y2014$comp_sales))
y2014a <- as.data.table(aggregate(sub2014, by = list(factor(sub2014$my)), FUN = sum))
y2014a$my <- NULL
subm2014 <- melt.data.table(y2014a,measure.vars = c("ford","comp"))

ggplot(data = subm2014, aes(x = Group.1, y = value, group = variable)) + 
  geom_line(aes(color = variable))

#2013
y2013 <- fdf[fdf["year"] == 2013,]

sub2013 <- as.data.table(cbind(my = y2013$month_year, ford = y2013$ford_sales, comp = y2013$comp_sales))
y2013a <- as.data.table(aggregate(sub2013, by = list(factor(sub2013$my)), FUN = sum))
y2013a$my <- NULL
subm2013 <- melt.data.table(y2013a,measure.vars = c("ford","comp"))

ggplot(data = subm2013, aes(x = Group.1, y = value, group = variable)) + 
  geom_line(aes(color = variable))

#2012
y2012 <- fdf[fdf["year"] == 2012,]

sub2012 <- as.data.table(cbind(my = y2012$month_year, ford = y2012$ford_sales, comp = y2012$comp_sales))
y2012a <- as.data.table(aggregate(sub2012, by = list(factor(sub2012$my)), FUN = sum))
y2012a$my <- NULL
subm2012 <- melt.data.table(y2012a,measure.vars = c("ford","comp"))

ggplot(data = subm2012, aes(x = Group.1, y = value, group = variable)) + 
  geom_line(aes(color = variable))

#By Segment
subseg <- as.data.table(cbind.data.frame(seg = fdf$segment, month = fdf$month_name, ford = fdf$ford_sales, comp = fdf$comp_sales, total = fdf$total_segment_sales))
str(subseg)

#s1
seg1 <- subseg[subseg$seg == "Segment1",2:5]
seg1a <- as.data.table(aggregate(cbind(ford = seg1$ford, comp = seg1$comp, total = seg1$total) ~ seg1$month, FUN = sum))
seg1m <- melt.data.table(seg1a, measure.vars = c("ford", "comp", "total"))
ggplot(data = seg1m, aes(x = `seg1$month` , y = value, group = variable)) + 
  geom_line(aes(color = variable))

#s2
seg2 <- subseg[subseg$seg == "Segment2",2:5]
seg2a <- as.data.table(aggregate(cbind(ford = seg2$ford, comp = seg2$comp, total = seg2$total) ~ seg2$month, FUN = sum))
seg2m <- melt.data.table(seg2a, measure.vars = c("ford", "comp", "total"))
ggplot(data = seg2m, aes(x = `seg2$month` , y = value, group = variable)) + 
  geom_line(aes(color = variable))

#s3
seg3 <- subseg[subseg$seg == "Segment3",2:5]
seg3a <- as.data.table(aggregate(cbind(ford = seg3$ford, comp = seg3$comp, total = seg3$total) ~ seg3$month, FUN = sum))
seg3m <- melt.data.table(seg3a, measure.vars = c("ford", "comp", "total"))
ggplot(data = seg3m, aes(x = `seg3$month` , y = value, group = variable)) + 
  geom_line(aes(color = variable))

```
From the plot, I found that in general, our and comp's sales are moving together with total_segment_sales.
The sales for us and comp's are vary from segment to segment.

#Generate variables
```{r}
#Sales gap - previous month
fdf$salesgap = fdf$ford_sales - fdf$comp_sales

#Sales gap - next month
fdf$salesgap_ahead = fdf$ford_sales_ahead_one - fdf$comp_sales_ahead_one

#Sales gap - next two month
fdf$salesgap_ahead_two = fdf$ford_sales_ahead_two - fdf$comp_sales_ahead_two

fdf$salesgap_lag_one = fdf$ford_sales_lag_one - fdf$comp_sales_lag_one

```

#Take a look for the x variables
```{r}
colSums(is.na(fdf))
?plotNormalHistogram

plotNormalHistogram(fdf$salesgap)

plotNormalHistogram(fdf$salesgap_ahead)

plotNormalHistogram(fdf$cost)
plotNormalHistogram(log(fdf$cost+1))
plotNormalHistogram(sign(fdf$cost) * abs(fdf$cost)^(1/3))
plotNormalHistogram(sqrt(fdf$cost))
#
fdf$cost_log <- log(fdf$cost+1)


plotNormalHistogram(fdf$impressions)
plotNormalHistogram(log(fdf$impressions+1))
plotNormalHistogram(sign(fdf$impressions) * abs(fdf$impressions)^(1/3))
#
fdf$imp_cub <- sign(fdf$impressions) * abs(fdf$impressions)^(1/3)

plotNormalHistogram(fdf$clicks)
plotNormalHistogram(log(fdf$clicks+1))
plotNormalHistogram(sign(fdf$clicks) * abs(fdf$clicks)^(1/3))
#
fdf$click_cub <- sign(fdf$clicks) * abs(fdf$clicks)^(1/3)

plotNormalHistogram(fdf$click_thru_rate)
plotNormalHistogram(log(fdf$click_thru_rate+1))
plotNormalHistogram(sign(fdf$click_thru_rate) * abs(fdf$click_thru_rate)^(1/3))
#
fdf$ctr_cub <- sign(fdf$click_thru_rate) * abs(fdf$click_thru_rate)^(1/3)

plotNormalHistogram(fdf$engagement)
plotNormalHistogram(log(fdf$engagement+1))
plotNormalHistogram(sign(fdf$engagement) * abs(fdf$engagement)^(1/3))
#
fdf$eng_cub <- sign(fdf$engagement) * abs(fdf$engagement)^(1/3)

plotNormalHistogram(fdf$engagement_per_click)
summary(fdf$engagement_per_click)
plotNormalHistogram(log(fdf$engagement_per_click+1))
plotNormalHistogram(sign(fdf$engagement_per_click) * abs(fdf$engagement_per_click)^(1/3))
#
fdf$epc_log <- log(fdf$engagement_per_click+1)

plotNormalHistogram(fdf$cost_per_engagement)
summary(fdf$cost_per_engagement)
plotNormalHistogram(log(fdf$cost_per_engagement+1))
plotNormalHistogram(sign(fdf$cost_per_engagement) * abs(fdf$cost_per_engagement)^(1/3))
#
fdf$cpe_log <- log(fdf$cost_per_engagement +1)

plotNormalHistogram(fdf$cost_per_click)
plotNormalHistogram(log(fdf$cost_per_click+1))
plotNormalHistogram(sign(fdf$cost_per_click) * abs(fdf$cost_per_click)^(1/3))
#
fdf$cpc_log <- log(fdf$cost_per_click +1)


plotNormalHistogram(fdf$quality_score)
summary(fdf$quality_score)
plotNormalHistogram(log(fdf$quality_score+1))
plotNormalHistogram(sign(fdf$quality_score) * abs(fdf$quality_score)^(1/3))
#
fdf$qua_cub <- sign(fdf$quality_score) * abs(fdf$quality_score)^(1/3)

plotNormalHistogram(fdf$price)
plotNormalHistogram(log(fdf$price+1))
plotNormalHistogram(sign(fdf$price) * abs(fdf$price)^(1/3))

plotNormalHistogram(fdf$incentives_percent)
plotNormalHistogram(log(fdf$incentives_percent+1))
plotNormalHistogram(sign(fdf$incentives_percent) * abs(fdf$incentives_percent)^(1/3) *10)

plotNormalHistogram(fdf$tv_spend)
plotNormalHistogram(log(fdf$tv_spend+1))
plotNormalHistogram(sign(fdf$tv_spend) * abs(fdf$tv_spend)^(1/3))
#
fdf$tv_cub <- sign(fdf$tv_spend) * abs(fdf$tv_spend)^(1/3)

plotNormalHistogram(fdf$digital_spend)
plotNormalHistogram(log(fdf$digital_spend+1))
plotNormalHistogram(sign(fdf$digital_spend) * abs(fdf$digital_spend)^(1/3))
#
fdf$digi_log <- log(fdf$digital_spend+1)

plotNormalHistogram(fdf$total_spend)
plotNormalHistogram(log(fdf$total_spend+1))
plotNormalHistogram(sign(fdf$total_spend) * abs(fdf$total_spend)^(1/3))
#
fdf$total_log <- log(fdf$total_spend+1)

```


#Check multicollinearity
```{r}
co <- cbind.data.frame(fdf[11:45])
corr <- cor(co)
vifcor(co)

co1 <- cbind.data.frame(fdf[40:51])
corr1 <- cor(co1)
vifcor(co1)

vifcor(cbind(fdf$ctr_cub, fdf$epc_log))
vifcor(cbind(fdf$cost_log, fdf$cpc_log))

#Don't use clicks and engagement
#Use the combination of ctr and epc for further analysis

co2 <- cbind.data.frame(fdf[26:41])
corr2 <- cor(co2)
vifcor(cbind(fdf$comp_sales, fdf$ford_sales, fdf$total_segment_sales, fdf$salesgap))
vifcor(cbind(fdf$comp_sales, fdf$ford_sales))
vifcor(cbind(fdf$comp_sales, fdf$ford_sales, fdf$total_segment_sales))

```

Analysis - Segment
#Segment
Segment1
```{r}
library(boot)
s1 <- fdf[fdf$segment == "Segment1",]

s1_1_1 <- lm(salesgap_ahead ~ brand + region + factor(month_year) + cost_log + price + incentives_percent + comp_sales + ford_sales + ctr_cub + epc_log + qua_cub + tv_cub + digi_log + total_segment_sales, data = s1 )
summary(s1_1_1)
AIC(s1_1_1) #75374.21
dwtest(s1_1_1)

s1_1_2 <- lm(salesgap_ahead ~ brand + region + factor(month_year) + cost_log + price + incentives_percent + comp_sales + ford_sales + qua_cub + tv_cub + digi_log + total_segment_sales, data = s1 )
summary(s1_1_2)
AIC(s1_1_2) #75374.04

s1_1_3 <- lm(salesgap_ahead ~ brand + region + factor(month_year) + cost_log + price + incentives_percent + salesgap + qua_cub + tv_cub + digi_log + total_segment_sales, data = s1 )
summary(s1_1_3)
AIC(s1_1_3) #75697.51

plot(s1_1_2)

#s1_1_2

```

Segment 2
```{r}
s2 <- fdf[fdf$segment == "Segment2",]
s2_1_1 <- lm(salesgap_ahead ~ brand + region + factor(month_year) + cost_log + price + incentives_percent + comp_sales + ford_sales + ctr_cub + epc_log + qua_cub + tv_cub + digi_log + total_segment_sales, data = s2 )
summary(s2_1_1)
AIC(s2_1_1) #220613.1
dwtest(s2_1_1)

s2_1_2 <- lm(salesgap_ahead ~ brand + region + factor(month_year) + cost_log + price + incentives_percent + comp_sales + ford_sales + ctr_cub + qua_cub + tv_cub + digi_log + total_segment_sales, data = s2 )
summary(s2_1_2)
AIC(s2_1_2) #220611.3

s2_1_3 <- lm(salesgap_ahead ~ brand + region + factor(month_year) + cost_log + price + incentives_percent + comp_sales + ford_sales + ctr_cub + qua_cub + total_log + total_segment_sales, data = s2 )
summary(s2_1_3)
AIC(s2_1_3) #220611.3

s2_1_4 <- lm(salesgap_ahead ~ brand + region + factor(month_year) + cost_log + price + incentives_percent + comp_sales + ford_sales + ctr_cub + qua_cub + tv_cub + total_segment_sales, data = s2 )
summary(s2_1_4)
AIC(s2_1_4) #220612.4

plot(s2_1_2)

#s2_1_2



```

Segment3
```{r}
s3 <- fdf[fdf$segment == "Segment3",]
s3_1_1 <- lm(salesgap_ahead ~ brand + region + factor(month_year) + cost_log + price + incentives_percent + comp_sales + ford_sales + ctr_cub + epc_log + qua_cub + tv_cub + digi_log + total_segment_sales, data = s3 )
summary(s3_1_1)
AIC(s3_1_1) #231859.5
dwtest(s3_1_1)

s3_1_2 <- lm(salesgap_ahead ~ brand + region + factor(month_year) + cost_log + price + incentives_percent + comp_sales + ford_sales + ctr_cub + epc_log + qua_cub + digi_log + total_segment_sales, data = s3 )
summary(s3_1_2)
AIC(s3_1_2) #231857.5

s3_1_3 <- lm(salesgap_ahead ~ brand + region + factor(month_year) + cost_log + price + incentives_percent + comp_sales + ford_sales + ctr_cub + epc_log + digi_log + total_segment_sales, data = s3 )
summary(s3_1_3)
AIC(s3_1_3) #231855.9

s3_1_4 <- lm(salesgap_ahead ~ brand + region + factor(month_year) + cost_log + price + incentives_percent + comp_sales + ford_sales + ctr_cub + epc_log + digi_log + total_segment_sales + origin, data = s3 )
summary(s3_1_4)
AIC(s3_1_4)

s3_1_5 <- lm(salesgap_ahead ~ brand + region + factor(month_year) + cost_log + price + incentives_percent + comp_sales + ford_sales + ctr_cub*epc_log + digi_log + total_segment_sales, data = s3 )
summary(s3_1_5)
AIC(s3_1_5) #231857.6

s3_1_6 <- lm(salesgap_ahead ~ brand + region + factor(month_year) + cost_log + price + incentives_percent + comp_sales + ford_sales + ctr_cub + epc_log + digi_log*tv_cub + total_segment_sales, data = s3 )
summary(s3_1_6)
AIC(s3_1_6) #231859.9

plot(s3_1_3)

#s3_1_3

```

Segment5
```{r}

s5 <- fdf[fdf$segment == "Segment5",]
s5_1_1 <- lm(salesgap_ahead ~ brand + region + factor(month_year) + cost_log + price + incentives_percent + comp_sales + ford_sales + ctr_cub + epc_log + qua_cub + tv_cub + digi_log + total_segment_sales, data = s5 )
summary(s5_1_1)
AIC(s5_1_1) #92309.49
dwtest(s5_1_1)

s5_1_2 <- lm(salesgap_ahead ~ brand + region + factor(month_year) + cost_log + price + incentives_percent + comp_sales + ford_sales + epc_log + qua_cub + tv_cub + digi_log + total_segment_sales, data = s5 )
summary(s5_1_2)
AIC(s5_1_2) #92307.53

s5_1_3 <- lm(salesgap_ahead ~ brand + region + factor(month_year) + cost_log + price + incentives_percent + comp_sales + ford_sales + epc_log + tv_cub + digi_log + total_segment_sales, data = s5 )
summary(s5_1_3)
AIC(s5_1_3) #92306.13

s5_1_4 <- lm(salesgap_ahead ~ brand + region + factor(month_year) + cost_log + price + incentives_percent + comp_sales + ford_sales + epc_log + digi_log + total_segment_sales, data = s5 )
summary(s5_1_4)
AIC(s5_1_4) #92305.36



```

Segment7
```{r}
s7 <- fdf[fdf$segment == "Segment7",]
summary(s7)
hist(s7$cost)
count(s7$cost)
s7_1_1 <- lm(salesgap_ahead ~ region + factor(month_year) + cost_log + price + incentives_percent + comp_sales + ford_sales + ctr_cub + epc_log + qua_cub + tv_cub + digi_log + total_segment_sales, data = s7 )
summary(s7_1_1)
AIC(s7_1_1) #15035.94
#At this segment, Ford didn't sell any car.

s7_1_2 <- lm(salesgap_ahead ~ region + factor(month_year) + cost_log + price + incentives_percent + comp_sales + ctr_cub + epc_log + qua_cub + tv_cub + digi_log + total_segment_sales, data = s7 )
summary(s7_1_2)
AIC(s7_1_2) #15035.94

vifcor(cbind(s7$incentives_percent, s7$price, s7$cost_log, s7$comp_sales))

#Ignore segment7!! -> 1904 cost = 0, no sales on Ford

```

Segment8
```{r}
s8 <- fdf[fdf$segment == "Segment8",]
summary(s8)
s8_1_1 <- lm(salesgap_ahead ~ region + brand + factor(month_year) + cost_log + price + incentives_percent + comp_sales + ford_sales + ctr_cub + epc_log + qua_cub + tv_cub + digi_log + total_segment_sales, data = s8 )
summary(s8_1_1)
AIC(s8_1_1) #94369.82
dwtest(s8_1_1)

s8_1_2 <- lm(salesgap_ahead ~ region + brand + factor(month_year) + cost_log + incentives_percent + comp_sales + ford_sales + ctr_cub + epc_log + qua_cub + tv_cub + digi_log + total_segment_sales, data = s8 )
summary(s8_1_2)
AIC(s8_1_2) #94368.04

s8_1_3 <- lm(salesgap_ahead ~ region + brand + factor(month_year) + cost_log + incentives_percent + comp_sales + ford_sales + ctr_cub + epc_log + tv_cub + digi_log + total_segment_sales, data = s8 )
summary(s8_1_3)
AIC(s8_1_3) #94366.31

s8_1_4 <- lm(salesgap_ahead ~ region + brand + factor(month_year) + cost_log + incentives_percent + comp_sales + ford_sales + ctr_cub*epc_log + tv_cub + digi_log + total_segment_sales, data = s8 )
summary(s8_1_4)
AIC(s8_1_4) #94361.73

plot(s8_1_4)

```

Segment9
```{r}
s9 <- fdf[fdf$segment == "Segment9",]
summary(s9)
s9_1_1 <- lm(salesgap_ahead ~ region + brand + factor(month_year) + cost_log + price + incentives_percent + comp_sales + ford_sales + ctr_cub + epc_log + qua_cub + tv_cub + digi_log + total_segment_sales, data = s9 )
summary(s9_1_1)
AIC(s9_1_1) #34202.55
dwtest(s9_1_1)

s9_1_2 <- lm(salesgap_ahead ~ region + brand + factor(month_year) + cost_log + price + incentives_percent + comp_sales + ford_sales + ctr_cub + epc_log + tv_cub + digi_log + total_segment_sales, data = s9 )
summary(s9_1_2)
AIC(s9_1_2) #34201.19

s9_1_3 <- lm(salesgap_ahead ~ region + brand + factor(month_year) + cost_log + price + incentives_percent + comp_sales + ford_sales + ctr_cub + epc_log + total_log + total_segment_sales, data = s9 )
summary(s9_1_3)
AIC(s9_1_3) #34198.84

s9_1_4 <- lm(salesgap_ahead ~ region + brand + factor(month_year) + cost_log + price + incentives_percent + comp_sales + ford_sales + ctr_cub + epc_log + total_segment_sales, data = s9 )
summary(s9_1_4)
AIC(s9_1_4) #34197.29

s9_1_5 <- lm(salesgap_ahead ~ region + brand + factor(month_year) + cost_log + price + incentives_percent + comp_sales + ford_sales + ctr_cub*epc_log + total_segment_sales, data = s9 )
summary(s9_1_5)
AIC(s9_1_5) #34193.82


```

Segment10
```{r}
s10 <- fdf[fdf$segment == "Segment10",]
summary(s10)
s10_1_1 <- lm(salesgap_ahead ~ region + brand + factor(month_year) + cost_log + price + incentives_percent + comp_sales + ford_sales + ctr_cub + epc_log + qua_cub + tv_cub + digi_log + total_segment_sales, data = s10 )
summary(s10_1_1)
AIC(s10_1_1) #141949.4
dwtest(s10_1_1)

s10_1_2 <- lm(salesgap_ahead ~ region + brand + factor(month_year) + cost_log + price + incentives_percent + comp_sales + ford_sales + ctr_cub + epc_log + qua_cub + tv_cub + digi_log + total_segment_sales, data = s10 )
summary(s10_1_2)
AIC(s10_1_2) #141949.4

s10_1_3 <- lm(salesgap_ahead ~ region + brand + factor(month_year) + cost_log + price + incentives_percent + comp_sales + ford_sales + ctr_cub* epc_log + qua_cub + tv_cub + digi_log + total_segment_sales, data = s10 )
summary(s10_1_3)
AIC(s10_1_3) #141950.4

s10_1_4 <- lm(salesgap_ahead ~ region + brand + factor(month_year) + cost_log + price + incentives_percent + comp_sales + ford_sales + ctr_cub + epc_log + qua_cub + tv_cub*digi_log + total_segment_sales, data = s10 )
summary(s10_1_4)
AIC(s10_1_4) #141916.7

s10_1_5 <- lm(salesgap_ahead ~ region + brand + factor(month_year) + cost_log + price + incentives_percent + comp_sales + ford_sales + epc_log + qua_cub + tv_cub*digi_log + total_segment_sales, data = s10 )
summary(s10_1_5)
AIC(s10_1_5) #141914.7

s10_1_6 <- lm(salesgap_ahead ~ region + brand + factor(month_year) + cost_log + price + incentives_percent + comp_sales + ford_sales + qua_cub + tv_cub*digi_log + total_segment_sales, data = s10 )
summary(s10_1_6)
AIC(s10_1_6) #141913.8

plot(s10_1_6)

ten <-as.data.frame(s10_1_6$coefficients[1:35])

```

Segment11
```{r}
s11 <- fdf[fdf$segment == "Segment11",]
summary(s11)
s11_1_1 <- lm(salesgap_ahead ~ region + brand + factor(month_year) + cost_log + price + incentives_percent + comp_sales + ford_sales + ctr_cub + epc_log + qua_cub + tv_cub + digi_log + total_segment_sales, data = s11 )
summary(s11_1_1)
AIC(s11_1_1) #83581.55
dwtest(s11_1_1) 

s11_1_2 <- lm(salesgap_ahead ~ region + brand + factor(month_year) + cost_log + price + incentives_percent + comp_sales + ford_sales + ctr_cub*epc_log + qua_cub + tv_cub + digi_log + total_segment_sales, data = s11 )
summary(s11_1_2)
AIC(s11_1_2) #83583.55

s11_1_3 <- lm(salesgap_ahead ~ region + brand + factor(month_year) + cost_log + comp_sales + ford_sales + ctr_cub + epc_log + qua_cub + tv_cub + digi_log + total_segment_sales, data = s11 )
summary(s11_1_3)
AIC(s11_1_3) #83579.95
plot(s11_1_3)

```

segment12
```{r}
s12 <- fdf[fdf$segment == "Segment12",]
summary(s12)
s12_1_1 <- lm(salesgap_ahead ~ region + brand + factor(month_year) + cost_log + price + incentives_percent + comp_sales + ford_sales + ctr_cub + epc_log + qua_cub + tv_cub + digi_log + total_segment_sales, data = s12 )
summary(s12_1_1)
AIC(s12_1_1) #37892.06
dwtest(s12_1_1) 

s12_1_2 <- lm(salesgap_ahead ~ region + brand + factor(month_year) + cost_log + price + incentives_percent + comp_sales + ford_sales + ctr_cub + epc_log + qua_cub + total_segment_sales, data = s12 )
summary(s12_1_2)
AIC(s12_1_2) #37889.65

plot(s12_1_2)

```

Segment13
```{r}
s13 <- fdf[fdf$segment == "Segment13",]
summary(s13)
s13_1_1 <- lm(salesgap_ahead ~ region + factor(month_year) + cost_log + price + incentives_percent + comp_sales + ford_sales + ctr_cub + epc_log + qua_cub + tv_cub + digi_log + total_segment_sales, data = s13 )
summary(s13_1_1)

```

Segment14
```{r}
s14 <- fdf[fdf$segment == "Segment14",]
summary(s14)
s14_1_1 <- lm(salesgap_ahead ~ region + brand + factor(month_year) + cost_log + price + incentives_percent + comp_sales + ford_sales + ctr_cub + epc_log + qua_cub + tv_cub + digi_log + total_segment_sales, data = s14 )
summary(s14_1_1)
AIC(s14_1_1) #38985.53
dwtest(s14_1_1) 

s14_1_2 <- lm(salesgap_ahead ~ region + brand + factor(month_year) + cost_log + price + incentives_percent + salesgap + ctr_cub + epc_log + qua_cub + tv_cub + digi_log + total_segment_sales, data = s14 )
summary(s14_1_2)
AIC(s14_1_2) #38985.53
dwtest(s14_1_2)

```

Segment15
```{r}
s15 <- fdf[fdf$segment == "Segment15",]
summary(s15)
s15_1_1 <- lm(salesgap_ahead ~ region + brand + factor(month_year) + cost_log + price + incentives_percent + comp_sales + ford_sales + ctr_cub + epc_log + qua_cub + tv_cub + digi_log + total_segment_sales, data = s15 )
summary(s15_1_1)
AIC(s15_1_1) #253089.6
dwtest(s15_1_1) 

s15_1_2 <- lm(salesgap_ahead ~ region + brand + factor(month_year) + cost_log + price + incentives_percent + comp_sales + ford_sales + ctr_cub + epc_log + tv_cub + digi_log + total_segment_sales, data = s15 )
summary(s15_1_2)
AIC(s15_1_2)  #253088

s15_1_3 <- lm(salesgap_ahead ~ region + brand + factor(month_year) + cost_log + incentives_percent + comp_sales + ford_sales + ctr_cub + epc_log + tv_cub + digi_log + total_segment_sales, data = s15 )
summary(s15_1_3)
AIC(s15_1_3) #253088.4

s15_1_4 <- lm(salesgap_ahead ~ region + brand + factor(month_year) + cost_log + price + incentives_percent + comp_sales + ford_sales + ctr_cub*epc_log + tv_cub + digi_log + total_segment_sales, data = s15 )
summary(s15_1_4)
AIC(s15_1_4) #253089.5

plot(s15_1_2)

#s15_1_2

```

Segment16
```{r}
s16 <- fdf[fdf$segment == "Segment16",]
summary(s16)
s16_1_1 <- lm(salesgap_ahead ~ region + brand + factor(month_year) + cost_log + price + incentives_percent + comp_sales + ford_sales + ctr_cub + epc_log + qua_cub + tv_cub + digi_log + total_segment_sales, data = s16 )
summary(s16_1_1)
AIC(s16_1_1) #54035.99
dwtest(s16_1_1) 

s16_1_2 <- lm(salesgap_ahead ~ region + brand + factor(month_year) + cost_log + price + incentives_percent + comp_sales + ford_sales + ctr_cub + epc_log + tv_cub + digi_log + total_segment_sales, data = s16 )
summary(s16_1_2)
AIC(s16_1_2) #54034.02

```




#Region
Region1
```{r}
r1 <- fdf[fdf$region == "Region1",]

r1_1_1 <- lm(salesgap_ahead ~ segment + factor(month_year) + cost_log + price + incentives_percent + comp_sales + ford_sales + ctr_cub + epc_log + qua_cub + tv_cub + digi_log + total_segment_sales, data = r1 )
summary(r1_1_1)
AIC(r1_1_1) #45063.38
dwtest(r1_1_1)

r1_1_2 <- lm(r1$salesgap_ahead ~ r1$segment + factor(r1$month_year) + r1$cost_log + r1$price + r1$incentives_percent + r1$comp_sales + r1$ford_sales + r1$ctr_cub + r1$tv_cub + r1$total_segment_sales )
summary(r1_1_2)
AIC(r1_1_2) #45057.91
dwtest(r1_1_2)

plot(r1_1_2)

```
Region2
```{r}
r2 <- fdf[fdf$region == "Region2",]
r2_1_1 <- lm(salesgap_ahead ~ segment + factor(month_year) + cost_log + price + incentives_percent + comp_sales + ford_sales + ctr_cub + epc_log + qua_cub + tv_cub + digi_log + total_segment_sales, data = r2 )
summary(r2_1_1)
AIC(r2_1_1) #45653.44
dwtest(r2_1_1)

r2_1_2 <- lm(r2$salesgap_ahead ~ r2$segment + factor(r2$month_year) + r2$cost_log + r2$price + r2$incentives_percent + r2$comp_sales + r2$ford_sales + r2$ctr_cub + r2$epc_log + r2$tv_cub + r2$total_segment_sales )
summary(r2_1_2)
AIC(r2_1_2) #45651.34
dwtest(r2_1_2)

plot(r2_1_2)

```

Region3
```{r}
r3 <- fdf[fdf$region == "Region3",]
r3_1_1 <- lm(salesgap_ahead ~ segment + factor(month_year) + cost_log + price + incentives_percent + comp_sales + ford_sales + ctr_cub + epc_log + qua_cub + tv_cub + digi_log + total_segment_sales, data = r3 )
summary(r3_1_1)
AIC(r3_1_1) #44425.48
dwtest(r3_1_1)

r3_1_2 <- lm(r3$salesgap_ahead ~ r3$segment + factor(r3$month_year) + r3$cost_log + r3$price + r3$incentives_percent + r3$comp_sales + r3$ford_sales + r3$ctr_cub + r3$epc_log + r3$qua_cub + r3$tv_cub + r3$total_segment_sales)
summary(r3_1_2)
AIC(r3_1_2) #44424.04
plot(r3_1_2)

```

Region4
```{r}
r4 <- fdf[fdf$region == "Region4",]
r4_1_1 <- lm(r4$salesgap_ahead ~ r4$segment + factor(r4$month_year) + r4$cost_log + r4$price + r4$incentives_percent + r4$comp_sales + r4$ford_sales + r4$ctr_cub + r4$epc_log + r4$qua_cub + r4$tv_cub + r4$digi_log + r4$total_segment_sales)
summary(r4_1_1)
AIC(r4_1_1) #40441.29
dwtest(r4_1_1)
```

Region5
```{r}
r5 <- fdf[fdf$region == "Region5",]
r5_1_1 <- lm(r5$salesgap_ahead ~ r5$segment + factor(r5$month_year) + r5$cost_log + r5$price + r5$incentives_percent + r5$comp_sales + r5$ford_sales + r5$ctr_cub + r5$epc_log + r5$qua_cub + r5$tv_cub + r5$digi_log + r5$total_segment_sales)
summary(r5_1_1)
AIC(r5_1_1) #42366.55
dwtest(r5_1_1)

```

Region6
```{r}
r6 <- fdf[fdf$region == "Region6",]
r6_1_1 <- lm(r6$salesgap_ahead ~ r6$segment + factor(r6$month_year) + r6$cost_log + r6$price + r6$incentives_percent + r6$comp_sales + r6$ford_sales + r6$ctr_cub + r6$epc_log + r6$qua_cub + r6$tv_cub + r6$digi_log + r6$total_segment_sales)
summary(r6_1_1)
AIC(r6_1_1) #42366.55
dwtest(r6_1_1)

```

Region7
```{r}
r7 <- fdf[fdf$region == "Region7",]
r7_1_1 <- lm(r7$salesgap_ahead ~ r7$segment + factor(r7$month_year) + r7$cost_log + r7$price + r7$incentives_percent + r7$comp_sales + r7$ford_sales + r7$ctr_cub + r7$epc_log + r7$qua_cub + r7$tv_cub + r7$digi_log + r7$total_segment_sales)
summary(r7_1_1)
AIC(r7_1_1) #40528.91
dwtest(r7_1_1)

r7_1_2 <- lm(r7$salesgap_ahead ~ r7$segment + factor(r7$month_year) + r7$cost_log + r7$price + r7$incentives_percent + r7$comp_sales + r7$ford_sales + r7$ctr_cub + r7$qua_cub + r7$tv_cub + r7$total_segment_sales)
summary(r7_1_2)
AIC(r7_1_2) #40525.2

```

Region8
```{r}
r8 <- fdf[fdf$region == "Region8",]
r8_1_1 <- lm(salesgap_ahead ~ segment + factor(month_year) + cost_log + price + incentives_percent + comp_sales + ford_sales + ctr_cub + epc_log + qua_cub + tv_cub + digi_log + total_segment_sales, data = r8)
summary(r8_1_1)
AIC(r8_1_1) #43451.33
dwtest(r8_1_1)

r8_1_2 <- lm(r8$salesgap_ahead ~ r8$segment + factor(r8$month_year) + r8$cost_log + r8$price + r8$incentives_percent + r8$comp_sales + r8$ford_sales + r8$ctr_cub + r8$epc_log + r8$tv_cub + r8$total_segment_sales)
summary(r8_1_2)
AIC(r8_1_2) #43448.46
```

Region9
```{r}
r9 <- fdf[fdf$region == "Region9",]
r9_1_1 <- lm(r9$salesgap_ahead ~ r9$segment + factor(r9$month_year) + r9$cost_log + r9$price + r9$incentives_percent + r9$comp_sales + r9$ford_sales + r9$ctr_cub + r9$epc_log + r9$qua_cub + r9$tv_cub + r9$digi_log + r9$total_segment_sales)
summary(r9_1_1)
AIC(r9_1_1) #46480.87
dwtest(r9_1_1)

```

Region10
```{r}
r10 <- fdf[fdf$region == "Region10",]
r10_1_1 <- lm(salesgap_ahead ~ segment + factor(month_year) + cost_log + price + incentives_percent + comp_sales + ford_sales + ctr_cub + epc_log + qua_cub + tv_cub + digi_log + total_segment_sales, data = r10 )
summary(r10_1_1)
AIC(r10_1_1) #44100.29
dwtest(r10_1_1)

r10_1_2 <- lm(r10$salesgap_ahead ~ r10$segment + factor(r10$month_year) + r10$cost_log + r10$price + r10$comp_sales + r10$ford_sales + r10$ctr_cub + r10$epc_log + r10$qua_cub + r10$tv_cub + r10$total_segment_sales)
summary(r10_1_2)
AIC(r10_1_2) #44096.52

```

Region11
```{r}
r11 <- fdf[fdf$region == "Region11",]
r11_1_1 <- lm(r11$salesgap_ahead ~ r11$segment + factor(r11$month_year) + r11$cost_log + r11$price + r11$incentives_percent + r11$comp_sales + r11$ford_sales + r11$ctr_cub + r11$epc_log + r11$qua_cub + r11$tv_cub + r11$digi_log + r11$total_segment_sales)
summary(r11_1_1)
AIC(r11_1_1) #44256.22
dwtest(r11_1_1)

r11_1_2 <- lm(r11$salesgap_ahead ~ r11$segment + factor(r11$month_year) + r11$cost_log + r11$price + r11$incentives_percent + r11$comp_sales + r11$ford_sales + r11$ctr_cub + r11$epc_log + r11$tv_cub + r11$total_segment_sales)
summary(r11_1_2)
AIC(r11_1_2) #44252.86

```

Region12
```{r}
r12 <- fdf[fdf$region == "Region12",]
r12_1_1 <- lm(salesgap_ahead ~ segment + factor(month_year) + cost_log + price + incentives_percent + comp_sales + ford_sales + ctr_cub + epc_log + qua_cub + tv_cub + digi_log + total_segment_sales, data = r12 )
summary(r12_1_1)
AIC(r12_1_1) #43288.32
dwtest(r12_1_1)

r12_1_2 <- lm(r12$salesgap_ahead ~ r12$segment + factor(r12$month_year) + r12$cost_log + r12$price + r12$incentives_percent + r12$comp_sales + r12$ford_sales + r12$ctr_cub + r12$epc_log + r12$qua_cub + r12$tv_cub + r12$total_segment_sales)
summary(r12_1_2)
AIC(r12_1_2) #43286.67

r12_1_3 <- lm(salesgap_ahead ~ segment + factor(month_year) + cost_log + incentives_percent + comp_sales + ford_sales + ctr_cub + epc_log + qua_cub + tv_cub + total_segment_sales, data = r12 )
summary(r12_1_3)
AIC(r12_1_3) #43287.35

#r12_1_2
```

Region13
```{r}
r13 <- fdf[fdf$region == "Region13",]
r13_1_1 <- lm(r13$salesgap_ahead ~ r13$segment + factor(r13$month_year) + r13$cost_log + r13$price + r13$incentives_percent + r13$comp_sales + r13$ford_sales + r13$ctr_cub + r13$epc_log + r13$qua_cub + r13$tv_cub + r13$digi_log + r13$total_segment_sales)
summary(r13_1_1)
AIC(r13_1_1) #47719.72
dwtest(r13_1_1)

```

Region14
```{r}
r14 <- fdf[fdf$region == "Region14",]
r14_1_1 <- lm(salesgap_ahead ~ segment + factor(month_year) + cost_log + price + incentives_percent + comp_sales + ford_sales + ctr_cub + epc_log + qua_cub + tv_cub + digi_log + total_segment_sales, data = r14 )
summary(r14_1_1)
AIC(r14_1_1) #46755.52
dwtest(r14_1_1)

r14_1_2 <- lm(r14$salesgap_ahead ~ r14$segment + factor(r14$month_year) + r14$cost_log + r14$price + r14$incentives_percent + r14$comp_sales + r14$ford_sales + r14$ctr_cub + r14$epc_log + r14$tv_cub + r14$digi_log + r14$total_segment_sales)
summary(r14_1_2)
AIC(r14_1_2) #46754.84

```

Region15
```{r}
r15 <- fdf[fdf$region == "Region15",]
r15_1_1 <- lm(salesgap_ahead ~ segment + factor(month_year) + cost_log + price + incentives_percent + comp_sales + ford_sales + ctr_cub + epc_log + qua_cub + tv_cub + digi_log + total_segment_sales, data = r15 )
summary(r15_1_1)
AIC(r15_1_1) #43878.62
dwtest(r15_1_1)

r15_1_2 <- lm(r15$salesgap_ahead ~ r15$segment + factor(r15$month_year) + r15$cost_log + r15$price + r15$incentives_percent + r15$comp_sales + r15$ford_sales + r15$ctr_cub + r15$epc_log + r15$tv_cub + r15$total_segment_sales)
summary(r15_1_2)
AIC(r15_1_2) #43878.62

```

Region16
```{r}
r16 <- fdf[fdf$region == "Region16",]
r16_1_1 <- lm(salesgap_ahead ~ segment + factor(month_year) + cost_log + price + incentives_percent + comp_sales + ford_sales + ctr_cub + epc_log + qua_cub + tv_cub + digi_log + total_segment_sales, data = r16 )
summary(r16_1_1)
AIC(r16_1_1) #43363.59
dwtest(r16_1_1)

r16_1_2 <- lm(r16$salesgap_ahead ~ r16$segment + factor(r16$month_year) + r16$cost_log + r16$price + r16$incentives_percent + r16$comp_sales + r16$ford_sales + r16$epc_log + r16$qua_cub + r16$tv_cub + r16$total_segment_sales)
summary(r16_1_2)
AIC(r16_1_2) #43360.43

plot(r16_1_2)

```

Region17
```{r}
r17 <- fdf[fdf$region == "Region17",]
r17_1_1 <- lm(salesgap_ahead ~ segment + factor(month_year) + cost_log + price + incentives_percent + comp_sales + ford_sales + ctr_cub + epc_log + qua_cub + tv_cub + digi_log + total_segment_sales, data = r17 )
summary(r17_1_1)
AIC(r17_1_1) #48077.44
dwtest(r17_1_1)

r17_1_2 <- lm(salesgap_ahead ~ segment + factor(month_year) + cost_log + price + incentives_percent + comp_sales + ford_sales + ctr_cub + epc_log + qua_cub + tv_cub + total_segment_sales, data = r17 )
summary(r17_1_2)
AIC(r17_1_2) #48075.45

```

Region18
```{r}
r18 <- fdf[fdf$region == "Region18",]
r18_1_1 <- lm(salesgap_ahead ~ segment + factor(month_year) + cost_log + price + incentives_percent + comp_sales + ford_sales + ctr_cub + epc_log + qua_cub + tv_cub + digi_log + total_segment_sales, data = r18 )
summary(r18_1_1)
AIC(r18_1_1) #44842.95
dwtest(r18_1_1)

```

Region19
```{r}
r19 <- fdf[fdf$region == "Region19",]
r19_1_1 <- lm(salesgap_ahead ~ segment + factor(month_year) + cost_log + price + incentives_percent + comp_sales + ford_sales + ctr_cub + epc_log + qua_cub + tv_cub + digi_log + total_segment_sales, data = r19 )
summary(r19_1_1)
AIC(r19_1_1) #36019.06
dwtest(r19_1_1)

```

Region20
```{r}
r20 <- fdf[fdf$region == "Region20",]
r20_1_1 <- lm(salesgap_ahead ~ segment + factor(month_year) + cost_log + price + incentives_percent + comp_sales + ford_sales + ctr_cub + epc_log + qua_cub + tv_cub + digi_log + total_segment_sales, data = r20 )
summary(r20_1_1)
AIC(r20_1_1) #38933.48
dwtest(r20_1_1)

r20_1_2 <- lm(salesgap_ahead ~ segment + factor(month_year) + cost_log + price + incentives_percent + comp_sales + ford_sales + ctr_cub + epc_log + qua_cub + tv_cub + total_segment_sales, data = r20 )
summary(r20_1_2)
AIC(r20_1_2) #38931.48

```

Region21
```{r}
r21 <- fdf[fdf$region == "Region21",]
r21_1_1 <- lm(salesgap_ahead ~ segment + factor(month_year) + cost_log + price + incentives_percent + comp_sales + ford_sales + ctr_cub + epc_log + qua_cub + tv_cub + digi_log + total_segment_sales, data = r21 )
summary(r21_1_1)
AIC(r21_1_1) #41043.86
dwtest(r21_1_1)

r21_1_2 <- lm(salesgap_ahead ~ segment + factor(month_year) + cost_log + price + incentives_percent + comp_sales + ford_sales + ctr_cub + epc_log + tv_cub + total_segment_sales, data = r21 )
summary(r21_1_2)
AIC(r21_1_2) #41040.47

```

Region22
```{r}
r22 <- fdf[fdf$region == "Region22",]
r22_1_1 <- lm(salesgap_ahead ~ segment + factor(month_year) + cost_log + price + incentives_percent + comp_sales + ford_sales + ctr_cub + epc_log + qua_cub + tv_cub + digi_log + total_segment_sales, data = r22 )
summary(r22_1_1)
AIC(r22_1_1) #52854.08
dwtest(r22_1_1)

r22_1_2 <- lm(salesgap_ahead ~ segment + factor(month_year) + cost_log + incentives_percent + comp_sales + ford_sales + epc_log + qua_cub + tv_cub + total_segment_sales, data = r22 )
summary(r22_1_2)
AIC(r22_1_2) #52848.58

```

Region23
```{r}
r23 <- fdf[fdf$region == "Region23",]
r23_1_1 <- lm(salesgap_ahead ~ segment + factor(month_year) + cost_log + price + incentives_percent + comp_sales + ford_sales + ctr_cub + epc_log + qua_cub + tv_cub + digi_log + total_segment_sales, data = r23 )
summary(r23_1_1)
AIC(r23_1_1) #44484.45
dwtest(r23_1_1)

```

Region24
```{r}
r24 <- fdf[fdf$region == "Region24",]
r24_1_1 <- lm(salesgap_ahead ~ segment + factor(month_year) + cost_log + price + incentives_percent + comp_sales + ford_sales + ctr_cub + epc_log + qua_cub + tv_cub + digi_log + total_segment_sales, data = r24 )
summary(r24_1_1)
AIC(r24_1_1) #44151.21
dwtest(r24_1_1)

r24_1_2 <- lm(salesgap_ahead ~ segment + factor(month_year) + cost_log + price + incentives_percent + comp_sales + ford_sales + ctr_cub + epc_log + qua_cub + tv_cub + total_segment_sales, data = r24 )
summary(r24_1_2)
AIC(r24_1_2) #44149.3

```

Region25
```{r}
r25 <- fdf[fdf$region == "Region25",]
r25_1_1 <- lm(salesgap_ahead ~ segment + factor(month_year) + cost_log + price + incentives_percent + comp_sales + ford_sales + ctr_cub + epc_log + qua_cub + tv_cub + digi_log + total_segment_sales, data = r25 )
summary(r25_1_1)
AIC(r25_1_1) #46234.53
dwtest(r25_1_1)

r25_1_2 <- lm(salesgap_ahead ~ segment + factor(month_year) + cost_log + price + incentives_percent + comp_sales + ford_sales + ctr_cub + epc_log + qua_cub + tv_cub + total_segment_sales, data = r25 )
summary(r25_1_2)
AIC(r25_1_2) #46232.87

```

Region26
```{r}
r26 <- fdf[fdf$region == "Region26",]
r26_1_1 <- lm(salesgap_ahead ~ segment + factor(month_year) + cost_log + price + incentives_percent + comp_sales + ford_sales + ctr_cub + epc_log + qua_cub + tv_cub + digi_log + total_segment_sales, data = r26 )
summary(r26_1_1)
AIC(r26_1_1) #40040.19
dwtest(r26_1_1)

```

Region27
```{r}
r27 <- fdf[fdf$region == "Region27",]
r27_1_1 <- lm(salesgap_ahead ~ segment + factor(month_year) + cost_log + price + incentives_percent + comp_sales + ford_sales + ctr_cub + epc_log + qua_cub + tv_cub + digi_log + total_segment_sales, data = r27 )
summary(r27_1_1)
AIC(r27_1_1) #38169.3
dwtest(r27_1_1)

r27_1_2 <- lm(salesgap_ahead ~ segment + factor(month_year) + cost_log + price + incentives_percent + comp_sales + ford_sales + ctr_cub + epc_log + qua_cub + tv_cub + total_segment_sales, data = r27 )
summary(r27_1_2)
AIC(r27_1_2) #38167.41

plot(r27_1_2)

```

Region28
```{r}
r28 <- fdf[fdf$region == "Region28",]
r28_1_1 <- lm(salesgap_ahead ~ segment + factor(month_year) + cost_log + price + incentives_percent + comp_sales + ford_sales + ctr_cub + epc_log + qua_cub + tv_cub + digi_log + total_segment_sales, data = r28 )
summary(r28_1_1)

```

Region29
```{r}
r29 <- fdf[fdf$region == "Region29",]
r29_1_1 <- lm(salesgap_ahead ~ segment + factor(month_year) + cost_log + price + incentives_percent + comp_sales + ford_sales + ctr_cub + epc_log + qua_cub + tv_cub + digi_log + total_segment_sales, data = r29 )
summary(r29_1_1)

```

Region30
```{r}
r30 <- fdf[fdf$region == "Region30",]
r30_1_1 <- lm(salesgap_ahead ~ segment + factor(month_year) + cost_log + price + incentives_percent + comp_sales + ford_sales + ctr_cub + epc_log + qua_cub + tv_cub + digi_log + total_segment_sales, data = r30 )
summary(r30_1_1)
```

Region31
```{r}
r31 <- fdf[fdf$region == "Region31",]
r31_1_1 <- lm(salesgap_ahead ~ segment + factor(month_year) + cost_log + price + incentives_percent + comp_sales + ford_sales + ctr_cub + epc_log + qua_cub + tv_cub + digi_log + total_segment_sales, data = r31 )
summary(r31_1_1)
AIC(r31_1_1) #34153.03
dwtest(r31_1_1)

```

Region32
```{r}
r32 <- fdf[fdf$region == "Region32",]
r32_1_1 <- lm(salesgap_ahead ~ segment + factor(month_year) + cost_log + price + incentives_percent + comp_sales + ford_sales + ctr_cub + epc_log + qua_cub + tv_cub + digi_log + total_segment_sales, data = r32 )
summary(r32_1_1)

```

SUR
System list build up
```{r}
R1 <- r1$salesgap_ahead ~ r1$segment + factor(r1$month_year) + r1$cost_log + r1$price + r1$incentives_percent + r1$comp_sales + r1$ford_sales + r1$ctr_cub + r1$tv_cub + r1$total_segment_sales

R2 <- r2$salesgap_ahead ~ r2$segment + factor(r2$month_year) + r2$cost_log + r2$price + r2$incentives_percent + r2$comp_sales + r2$ford_sales + r2$ctr_cub + r2$epc_log + r2$tv_cub + r2$total_segment_sales

R3 <- r3$salesgap_ahead ~ r3$segment + factor(r3$month_year) + r3$cost_log + r3$price + r3$incentives_percent + r3$comp_sales + r3$ford_sales + r3$ctr_cub + r3$epc_log + r3$qua_cub + r3$tv_cub + r3$total_segment_sales

R4 <- r4$salesgap_ahead ~ r4$segment + factor(r4$month_year) + r4$cost_log + r4$price + r4$incentives_percent + r4$comp_sales + r4$ford_sales + r4$ctr_cub + r4$epc_log + r4$qua_cub + r4$tv_cub + r4$digi_log + r4$total_segment_sales

R5 <- r5$salesgap_ahead ~ r5$segment + factor(r5$month_year) + r5$cost_log + r5$price + r5$incentives_percent + r5$comp_sales + r5$ford_sales + r5$ctr_cub + r5$epc_log + r5$qua_cub + r5$tv_cub + r5$digi_log + r5$total_segment_sales

R6 <- r6$salesgap_ahead ~ r6$segment + factor(r6$month_year) + r6$cost_log + r6$price + r6$incentives_percent + r6$comp_sales + r6$ford_sales + r6$ctr_cub + r6$epc_log + r6$qua_cub + r6$tv_cub + r6$digi_log + r6$total_segment_sales

R7 <- r7$salesgap_ahead ~ r7$segment + factor(r7$month_year) + r7$cost_log + r7$price + r7$incentives_percent + r7$comp_sales + r7$ford_sales + r7$ctr_cub + r7$qua_cub + r7$tv_cub + r7$total_segment_sales

R8 <- r8$salesgap_ahead ~ r8$segment + factor(r8$month_year) + r8$cost_log + r8$price + r8$incentives_percent + r8$comp_sales + r8$ford_sales + r8$ctr_cub + r8$epc_log + r8$tv_cub + r8$total_segment_sales

R9 <- r9$salesgap_ahead ~ r9$segment + factor(r9$month_year) + r9$cost_log + r9$price + r9$incentives_percent + r9$comp_sales + r9$ford_sales + r9$ctr_cub + r9$epc_log + r9$qua_cub + r9$tv_cub + r9$digi_log + r9$total_segment_sales

R10 <- r10$salesgap_ahead ~ r10$segment + factor(r10$month_year) + r10$cost_log + r10$price + r10$comp_sales + r10$ford_sales + r10$ctr_cub + r10$epc_log + r10$qua_cub + r10$tv_cub + r10$total_segment_sales

R11 <- r11$salesgap_ahead ~ r11$segment + factor(r11$month_year) + r11$cost_log + r11$price + r11$incentives_percent + r11$comp_sales + r11$ford_sales + r11$ctr_cub + r11$epc_log + r11$tv_cub + r11$total_segment_sales

R12 <- r12$salesgap_ahead ~ r12$segment + factor(r12$month_year) + r12$cost_log + r12$price + r12$incentives_percent + r12$comp_sales + r12$ford_sales + r12$ctr_cub + r12$epc_log + r12$qua_cub + r12$tv_cub + r12$total_segment_sales

R13 <- r13$salesgap_ahead ~ r13$segment + factor(r13$month_year) + r13$cost_log + r13$price + r13$incentives_percent + r13$comp_sales + r13$ford_sales + r13$ctr_cub + r13$epc_log + r13$qua_cub + r13$tv_cub + r13$digi_log + r13$total_segment_sales

R14 <- r14$salesgap_ahead ~ r14$segment + factor(r14$month_year) + r14$cost_log + r14$price + r14$incentives_percent + r14$comp_sales + r14$ford_sales + r14$ctr_cub + r14$epc_log + r14$tv_cub + r14$digi_log + r14$total_segment_sales

R15 <- r15$salesgap_ahead ~ r15$segment + factor(r15$month_year) + r15$cost_log + r15$price + r15$incentives_percent + r15$comp_sales + r15$ford_sales + r15$ctr_cub + r15$epc_log + r15$tv_cub + r15$total_segment_sales

R16 <- r16$salesgap_ahead ~ r16$segment + factor(r16$month_year) + r16$cost_log + r16$price + r16$incentives_percent + r16$comp_sales + r16$ford_sales + r16$epc_log + r16$qua_cub + r16$tv_cub + r16$total_segment_sales

R17 <- r17$salesgap_ahead ~ r17$segment + factor(r17$month_year) + r17$cost_log + r17$price + r17$incentives_percent + r17$comp_sales + r17$ford_sales + r17$ctr_cub + r17$epc_log + r17$qua_cub + r17$tv_cub + r17$total_segment_sales

R18 <- r18$salesgap_ahead ~ r18$segment + factor(r18$month_year) + r18$cost_log + r18$price + r18$incentives_percent + r18$comp_sales + r18$ford_sales + r18$ctr_cub + r18$epc_log + r18$qua_cub + r18$tv_cub + r18$digi_log + r18$total_segment_sales

R19 <- r19$salesgap_ahead ~ r19$segment + factor(r19$month_year) + r19$cost_log + r19$price + r19$incentives_percent + r19$comp_sales + r19$ford_sales + r19$ctr_cub + r19$epc_log + r19$qua_cub + r19$tv_cub + r19$digi_log + r19$total_segment_sales

R20 <- r20$salesgap_ahead ~ r20$segment + factor(r20$month_year) + r20$cost_log + r20$price + r20$incentives_percent + r20$comp_sales + r20$ford_sales + r20$ctr_cub + r20$epc_log + r20$qua_cub + r20$tv_cub + r20$total_segment_sales

R21 <- r21$salesgap_ahead ~ r21$segment + factor(r21$month_year) + r21$cost_log + r21$price + r21$incentives_percent + r21$comp_sales + r21$ford_sales + r21$ctr_cub + r21$epc_log + r21$tv_cub + r21$total_segment_sales

R22 <- r22$salesgap_ahead ~ r22$segment + factor(r22$month_year) + r22$cost_log + r22$incentives_percent + r22$comp_sales + r22$ford_sales + r22$epc_log + r22$qua_cub + r22$tv_cub + r22$total_segment_sales

R23 <- r23$salesgap_ahead ~ r23$segment + factor(r23$month_year) + r23$cost_log + r23$price + r23$incentives_percent + r23$comp_sales + r23$ford_sales + r23$ctr_cub + r23$epc_log + r23$qua_cub + r23$tv_cub + r23$digi_log + r23$total_segment_sales

R24 <- r24$salesgap_ahead ~ r24$segment + factor(r24$month_year) + r24$cost_log + r24$price + r24$incentives_percent + r24$comp_sales + r24$ford_sales + r24$ctr_cub + r24$epc_log + r24$qua_cub + r24$tv_cub + r24$total_segment_sales

R25 <- r25$salesgap_ahead ~ r25$segment + factor(r25$month_year) + r25$cost_log + r25$price + r25$incentives_percent + r25$comp_sales + r25$ford_sales + r25$ctr_cub + r25$epc_log + r25$qua_cub + r25$tv_cub + r25$total_segment_sales

R26 <- r26$salesgap_ahead ~ r26$segment + factor(r26$month_year) + r26$cost_log + r26$price + r26$incentives_percent + r26$comp_sales + r26$ford_sales + r26$ctr_cub + r26$epc_log + r26$qua_cub + r26$tv_cub + r26$digi_log + r26$total_segment_sales

R27 <- r27$salesgap_ahead ~ r27$segment + factor(r27$month_year) + r27$cost_log + r27$price + r27$incentives_percent + r27$comp_sales + r27$ford_sales + r27$ctr_cub + r27$epc_log + r27$qua_cub + r27$tv_cub + r27$total_segment_sales

R28 <- r28$salesgap_ahead ~ r28$segment + factor(r28$month_year) + r28$cost_log + r28$price + r28$incentives_percent + r28$comp_sales + r28$ford_sales + r28$ctr_cub + r28$epc_log + r28$qua_cub + r28$tv_cub + r28$digi_log + r28$total_segment_sales

R29 <- r29$salesgap_ahead ~ r29$segment + factor(r29$month_year) + r29$cost_log + r29$price + r29$incentives_percent + r29$comp_sales + r29$ford_sales + r29$ctr_cub + r29$epc_log + r29$qua_cub + r29$tv_cub + r29$digi_log + r29$total_segment_sales

R30 <- r30$salesgap_ahead ~ r30$segment + factor(r30$month_year) + r30$cost_log + r30$price + r30$incentives_percent + r30$comp_sales + r30$ford_sales + r30$ctr_cub + r30$epc_log + r30$qua_cub + r30$tv_cub + r30$digi_log + r30$total_segment_sales

R31 <- r31$salesgap_ahead ~ r31$segment + factor(r31$month_year) + r31$cost_log + r31$price + r31$incentives_percent + r31$comp_sales + r31$ford_sales + r31$ctr_cub + r31$epc_log + r31$qua_cub + r31$tv_cub + r31$digi_log + r31$total_segment_sales

R32 <- r32$salesgap_ahead ~ r32$segment + factor(r32$month_year) + r32$cost_log + r32$price + r32$incentives_percent + r32$comp_sales + r32$ford_sales + r32$ctr_cub + r32$epc_log + r32$qua_cub + r32$tv_cub + r32$digi_log + r32$total_segment_sales

```

```{r}
library(systemfit)

for (i in c(1:32)){
  print(paste("r",i,"=","R",i, sep = ""))
}

system <- list(r1=R1,r2=R2,r3=R3,r4=R4,r5=R5,r6=R6,r7=R7,r8=R8,r9=R9,r10=R10,r11=R11,r12=R12,r13=R13,r14=R14,r15=R15,r16=R16,r17=R17,r18=R18,r19=R19,r20=R20,r21=R21,r22=R22,r23=R23,r24=R24,r25=R25,r26=R26,r27=R27,r28=R28,r29=R29,r30=R30,r31=R31,r32=R32)
sur <- systemfit(system, method = "SUR")
summary <- summary(sur)

write.csv(summary, file = "outputsur.csv")

```



